name: Garmin to GSheets Sync

on:
  schedule:
    - cron: '0 10 * * *' # Runs every day at 2AM PST
  workflow_dispatch:      # Allows you to click "Run" manually

jobs:
  run-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install typer gspread oauth2client garminconnect python-dotenv

      - name: Execute Garmin Sync
        env:
          # This maps your Secrets to the "USER1" profile the script expects
          USER1_GARMIN_EMAIL: ${{ secrets.GARMIN_EMAIL }}
          USER1_GARMIN_PASSWORD: ${{ secrets.GARMIN_PASSWORD }}
          USER1_SHEET_ID: ${{ secrets.SPREADSHEET_ID }}
          USER1_SHEET_NAME: "Garmin_Data"
        run: |
          # This calculates "yesterday" and "today" for the script
          START_DATE=$(date -d "yesterday" '+%Y-%m-%d')
          END_DATE=$(date '+%Y-%m-%d')
          
          # This runs the CLI command in your main.py
          python main.py cli-sync --start-date "$START_DATE" --end-date "$END_DATE" --profile "USER1" --output-type "sheets"
